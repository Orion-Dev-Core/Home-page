<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Orion Dev Core | Tactical AI Command</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://js.yoco.com/sdk/v1/yoco-sdk-web.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: radial-gradient(circle at top center, #1c1c1f 0%, #09090b 100%);
            color: #fafafa; 
            margin: 0;
            overflow-x: hidden;
        }

        .bg-dot-grid {
            background-size: 30px 30px;
            background-image: radial-gradient(circle, #27272a 0.5px, transparent 0.5px);
        }

        .zinc-card { 
            background: rgba(24, 24, 27, 0.8); 
            backdrop-filter: blur(12px);
            border: 1px solid rgba(63, 63, 70, 0.5); 
            border-radius: 2rem; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .zinc-card:hover {
            border-color: #D4AF37;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.1);
        }

        .gold-text { color: #D4AF37; }
        .gold-bg { background: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%); color: #000; }
        
        .hidden { display: none !important; }

        .logo-glow {
            filter: drop-shadow(0 0 15px rgba(212, 175, 55, 0.4));
        }

        /* Responsive Mobile Fixes */
        @media (max-width: 640px) {
            .text-7xl { font-size: 3.5rem; }
        }
    </style>
</head>
<body class="bg-dot-grid min-h-screen">

<div id="app" class="max-w-6xl mx-auto px-4 py-8">

    <nav class="flex justify-between items-center mb-16">
        <div class="flex items-center gap-3">
            <div class="logo-glow gold-text">
                <i data-lucide="orbit" class="w-10 h-10"></i> 
            </div>
            <span class="text-xl font-black tracking-tighter uppercase">Orion <span class="gold-text">Dev Core</span></span>
        </div>
        <button onclick="switchView('login')" class="text-xs font-bold uppercase tracking-widest text-zinc-500 hover:text-white transition">Partner Login</button>
    </nav>

    <div id="view-home" class="flex flex-col items-center space-y-20">
        <div class="text-center space-y-8">
            <div class="inline-block px-4 py-1 rounded-full border border-zinc-700 bg-zinc-900/80 text-[10px] font-bold tracking-widest text-zinc-400 uppercase">
                Secure Neural Interface Active
            </div>
            <h1 class="text-6xl md:text-8xl font-extrabold tracking-tighter text-white leading-tight">
                The Office <br/><span class="gold-text italic">Redefined.</span>
            </h1>
            <p class="max-w-xl text-zinc-500 text-lg mx-auto font-medium">
                Autonomous legal operation protocols. Select your tier to begin integration.
            </p>
        </div>

        <div id="marketing-pricing" class="grid md:grid-cols-3 gap-8 w-full">
            </div>
    </div>

    <div id="view-login" class="hidden max-w-md mx-auto py-20">
        <div class="zinc-card p-10 shadow-2xl text-center">
            <i data-lucide="shield-check" class="w-12 h-12 gold-text mx-auto mb-6"></i>
            <h2 class="text-2xl font-bold mb-2">Access Granted?</h2>
            <p class="text-zinc-500 text-sm mb-8">Verification of Biometric ID required.</p>
            <input type="text" id="loginId" placeholder="BIO-XXXX" class="w-full bg-black/50 border border-zinc-800 p-4 rounded-2xl mb-4 focus:border-[#D4AF37] outline-none text-white text-center tracking-widest">
            <button onclick="handleLogin()" id="btnLogin" class="w-full gold-bg p-4 rounded-2xl font-black uppercase tracking-widest hover:scale-[1.02] transition">Authorize</button>
            <button onclick="switchView('home')" class="w-full text-zinc-600 text-xs mt-8 hover:text-zinc-300">Abort & Exit</button>
        </div>
    </div>

    <div id="view-register" class="hidden max-w-md mx-auto py-10">
        <div class="zinc-card p-10 shadow-2xl">
            <h2 class="text-2xl font-bold mb-6">New Link</h2>
            <input type="text" id="regName" placeholder="Full Name" class="w-full bg-black/50 border border-zinc-800 p-4 rounded-2xl mb-4 outline-none text-white">
            <input type="email" id="regEmail" placeholder="Email" class="w-full bg-black/50 border border-zinc-800 p-4 rounded-2xl mb-4 outline-none text-white">
            <select id="regPackage" class="w-full bg-black/50 border border-zinc-800 p-4 rounded-2xl mb-6 outline-none text-white"></select>
            
            <button onclick="handleRegister()" id="btnRegister" class="w-full gold-bg p-4 rounded-2xl font-black uppercase tracking-widest">Establish Link</button>
            <button onclick="switchView('home')" class="w-full text-zinc-600 text-xs mt-6 hover:text-zinc-300 transition text-center">Cancel</button>
        </div>
    </div>

    <div id="view-dashboard" class="hidden space-y-8">
        <div class="zinc-card p-8 flex justify-between items-center">
            <div>
                <p class="text-[10px] gold-text font-black uppercase tracking-widest">Partner Identity</p>
                <h1 class="text-4xl font-black uppercase" id="dashName"></h1>
                <p class="text-zinc-500 font-mono text-xs" id="dashId"></p>
            </div>
            <div id="adminAccess" class="hidden">
                 <button onclick="loadAdminPanel()" class="bg-zinc-800 border border-zinc-700 text-white px-6 py-3 rounded-2xl font-bold text-[10px] uppercase tracking-widest hover:border-gold-text transition">ðŸ‘‘ God Mode</button>
            </div>
        </div>

        <div class="grid md:grid-cols-3 gap-6">
            <div class="zinc-card p-8 bg-black/40">
                <span class="text-[10px] text-zinc-500 font-black uppercase">Active Tier</span>
                <div class="text-3xl font-black gold-text mt-2 uppercase tracking-tighter" id="dashPackage"></div>
            </div>
            <div class="zinc-card p-8 bg-black/40">
                <span class="text-[10px] text-zinc-500 font-black uppercase">Monthly Fee</span>
                <div class="text-3xl font-black mt-2" id="dashPrice"></div>
            </div>
            <button onclick="triggerYoco()" id="btnPay" class="gold-bg p-8 rounded-[2rem] font-black text-2xl uppercase tracking-widest flex items-center justify-center">
                 Pay Subscription
            </button>
        </div>

        <div class="zinc-card p-10">
            <h3 class="text-zinc-500 text-[10px] font-black uppercase mb-8 tracking-widest border-b border-zinc-800 pb-4">Neural Modules Enabled</h3>
            <div id="dashFeatures" class="grid sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
        </div>
        
        <div class="text-center">
            <button onclick="location.reload()" class="text-zinc-600 text-[10px] font-bold uppercase tracking-widest hover:text-white transition underline decoration-gold-text underline-offset-8">Terminate Session</button>
        </div>
    </div>

    <div id="view-admin" class="hidden space-y-6">
        <div class="flex justify-between items-center">
            <h1 class="text-3xl font-black gold-text tracking-tighter uppercase">Registry Logs</h1>
            <button onclick="switchView('dashboard')" class="bg-zinc-900 px-6 py-2 rounded-xl text-[10px] font-bold">Back</button>
        </div>
        <div class="zinc-card overflow-hidden">
            <table class="w-full text-left text-[11px]">
                <thead class="bg-black/50 border-b border-zinc-800 text-zinc-500">
                    <tr>
                        <th class="p-6 uppercase font-black">Stamp</th>
                        <th class="p-6 uppercase font-black">Entity</th>
                        <th class="p-6 uppercase font-black">Tier</th>
                        <th class="p-6 uppercase font-black">Bio_ID</th>
                    </tr>
                </thead>
                <tbody id="adminTableBody" class="divide-y divide-zinc-900/50"></tbody>
            </table>
        </div>
    </div>

</div>

<script>
    let products = [];
    let currentUser = null;

    function switchView(view) {
        ['view-home', 'view-login', 'view-register', 'view-dashboard', 'view-admin'].forEach(v => document.getElementById(v).classList.add('hidden'));
        document.getElementById('view-' + view).classList.remove('hidden');
        lucide.createIcons();
    }

    // --- HOME PAGE CARDS WITH ICONS ---
    function loadMarketingPricing() {
        google.script.run.withSuccessHandler(data => {
            products = data;
            const container = document.getElementById('marketing-pricing');
            const select = document.getElementById('regPackage');
            container.innerHTML = "";
            select.innerHTML = "";

            data.forEach(p => {
                let opt = document.createElement('option');
                opt.value = p.name; opt.innerText = p.name;
                select.appendChild(opt);

                // LOGO SELECTOR PER TIER
                let tierIcon = "bolt";
                if(p.name.includes("Mandisa")) tierIcon = "cpu";
                if(p.name.includes("Universe")) tierIcon = "component";

                container.innerHTML += `
                    <div class="zinc-card p-10 flex flex-col justify-between group cursor-pointer" onclick="selectPackage('${p.name}')">
                        <div>
                            <div class="gold-text mb-6 group-hover:scale-110 transition-transform duration-500">
                                <i data-lucide="${tierIcon}" class="w-10 h-10"></i>
                            </div>
                            <span class="text-[10px] gold-text font-black uppercase tracking-[0.2em]">${p.ai ? 'AI Neural' : 'Manual'}</span>
                            <h3 class="text-3xl font-black text-white mt-4 tracking-tighter uppercase">${p.name}</h3>
                            <div class="text-4xl font-black mt-6 mb-10 italic text-zinc-300 opacity-80">${p.price}</div>
                        </div>
                        <button class="w-full bg-zinc-900 border border-zinc-800 py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest group-hover:gold-bg transition-colors">
                            Establish Link
                        </button>
                    </div>`;
            });
            lucide.createIcons();
        }).apiGetProducts();
    }

    function selectPackage(name) {
        document.getElementById('regPackage').value = name;
        switchView('register');
    }

    // --- CORE LOGIC ---
    function handleLogin() {
        const id = document.getElementById('loginId').value;
        const btn = document.getElementById('btnLogin');
        btn.innerText = "LINKING...";
        google.script.run.withSuccessHandler(res => {
            btn.innerText = "AUTHORIZE";
            if(res.found) {
                currentUser = res.data;
                renderDashboard(res.data);
            } else { alert("ACCESS DENIED: IDENTITY UNKNOWN"); }
        }).apiSearchUser(id);
    }

    function renderDashboard(user) {
        switchView('dashboard');
        document.getElementById('dashName').innerText = user['Full Name'];
        document.getElementById('dashId').innerText = user['Biometric_ID'];
        document.getElementById('dashPackage').innerText = user['Package'];
        document.getElementById('dashPrice').innerText = user.priceDisplay || "FREE";

        const featBox = document.getElementById('dashFeatures');
        featBox.innerHTML = "";
        if(user.features) {
            user.features.forEach(f => {
                featBox.innerHTML += `
                    <div class="bg-black/40 border border-zinc-800 p-6 rounded-2xl flex items-center gap-4">
                        <i data-lucide="check-circle-2" class="w-5 h-5 gold-text"></i>
                        <span class="text-xs font-bold text-zinc-300">${f}</span>
                    </div>`;
            });
        }
        if(user.isAdmin) document.getElementById('adminAccess').classList.remove('hidden');
        lucide.createIcons();
    }

    function handleRegister() {
        const data = {
            fullName: document.getElementById('regName').value,
            email: document.getElementById('regEmail').value,
            package: document.getElementById('regPackage').value
        };
        google.script.run.withSuccessHandler(res => {
            alert("IDENTITY ESTABLISHED. ID: " + res.id);
            location.reload();
        }).apiRegisterUser(data);
    }

    function loadAdminPanel() {
        const tbody = document.getElementById('adminTableBody');
        tbody.innerHTML = "<tr><td colspan='4' class='p-20 text-center animate-pulse gold-text font-black uppercase tracking-[0.5em]'>Accessing registry...</td></tr>";
        switchView('admin');
        google.script.run.withSuccessHandler(res => {
            tbody.innerHTML = "";
            if(res.success) {
                res.users.forEach(u => {
                    tbody.innerHTML += `
                        <tr class="hover:bg-white/5 transition">
                            <td class="p-6 font-mono text-zinc-600">${u.Timestamp}</td>
                            <td class="p-6 font-bold text-white uppercase">${u['Full Name']}</td>
                            <td class="p-6"><span class="gold-text font-black uppercase text-[9px] border border-gold-text/30 px-3 py-1 rounded-full">${u.Package}</span></td>
                            <td class="p-6 font-mono text-zinc-400 tracking-widest">${u.Biometric_ID}</td>
                        </tr>`;
                });
            }
        }).apiGetAdminData(currentUser.Email);
    }

    window.onload = loadMarketingPricing;
</script>
</body>
</html>
